# AI Context - Security Now Archive Tools
**Version:** 3.3 ✅ CLEANUP COMPLETE + PATH CORRECTIONS  
**Last Updated:** 2026-01-16 15:30 CST by Perplexity AI  
**Project Phase:** Production - Clean Development Environment Achieved

---

## ✅ SYSTEM CLEANUP COMPLETE (2026-01-16 15:30)

### Cleanup Summary
- ✅ **Orphaned directories deleted:** 5 folders (~750MB reclaimed)
  - `C:\SecurityNow\`
  - `C:\SecurityNowTest\`
  - `D:\Desktop\SecurityNow-Setup\`
  - `D:\Desktop\SecurityNow-Test\`
  - `D:\Desktop\SecurityNow-Test-wkhtmltopdf\`

- ✅ **Local repos cleaned:** 11 duplicate/obsolete files removed
  - Private repo: 5 files deleted (contributing.md, Create-EpisodeDateIndex.ps1, etc.)
  - Public repo: 6 files deleted (.gitignore-private, test folders, etc.)

- ✅ **Git repos synced:** Both repos pushed to GitHub successfully
  - Private: Commit `74f27bc`
  - Public: Commit `3240e6b`

- ✅ **Verification passed:** Clean development environment confirmed
  - C:\ drive: No SecurityNow folders ✓
  - D:\Desktop: Only 2 repos remaining ✓
  - Git status: Working tree clean ✓

### Current Clean State
**C:\ Drive:**
- ✅ `C:\tools\whispercpp\` - Whisper installation only
- ✅ `C:\Program Files\wkhtmltopdf\` - PDF tool only
- ✅ No project files or test folders

**D:\Desktop:**
- ✅ `SecurityNow-Full-Private\` - Primary private development repo
- ✅ `SecurityNow-Full\` - Public tools mirror
- ✅ No orphaned test/setup folders

**Backup Created:**
- `D:\Backup\SecurityNow-Cleanup-20260116-152439\` - Full backup of deleted folders

---

## ⚠️ CRITICAL PATH CORRECTIONS (2026-01-16 15:30)

### PRIMARY REPOSITORY PATHS (CORRECTED - FINAL)
**❌ WRONG (All previous versions):**
```
D:\Desktop\SecurityNow-Full-Archive\
D:\Desktop\SecurityNow-Full\
```

**✅ CORRECT (Verified 2026-01-16 15:30):**
```
Local Private Repo:  D:\Desktop\SecurityNow-Full-Private\
GitHub Private Repo: msrproduct/securitynow-full-archive
Local Public Mirror: D:\Desktop\SecurityNow-Full\
GitHub Public Repo:  msrproduct/securitynow-archive-tools
```

**CRITICAL NOTES:**
- Local folder name (`SecurityNow-Full-Private`) ≠ GitHub repo name (`securitynow-full-archive`)
- This mismatch was causing confusion in all previous context versions
- `.ai-context.md` v3.3 is FIRST version with correct local path

**Validation:**
```powershell
Test-Path "D:\Desktop\SecurityNow-Full-Private\scripts\sn-full-run.ps1"  # Must return True
Test-Path "D:\Desktop\SecurityNow-Full\.git"  # Public mirror
```

### WHISPER PATH (ISSUE #0 - 4TH CORRECTION)
**❌ WRONG (AI keeps suggesting):**
```
C:\whisper-cli\whisper-cli.exe
C:\whispercpp\whisper-cli.exe
```

**✅ CORRECT (Verified multiple times):**
```
C:\tools\whispercpp\whisper-cli.exe
C:\tools\whispercpp\models\base.en.bin
```

### SYNC SCRIPT NAME
**❌ WRONG:** `Sync-Repos.ps1`, `Sync-Repo.ps1`  
**✅ CORRECT:** `Special-Sync.ps1`

---

## PROJECT OVERVIEW

### Mission
Archive all Security Now! podcast episodes (2005–2026+) with official GRC PDFs where available, AI-generated transcripts for missing episodes, and proper copyright separation between public tools and private media.

### Tech Stack
- **Languages:** PowerShell 7.x (required)
- **PDF Generation:** wkhtmltopdf 0.12.6
- **Transcription:** Whisper.cpp (base.en model)
- **Version Control:** Git with dual remotes (public + private)
- **File Storage:** Git LFS for MP3/PDF in private repo

### Critical Constraints
- **Legal:** Never commit copyrighted media (PDFs, MP3s) to public repo
- **Performance:** ~1,060 episodes × 3–5 min/episode = 50–85 hours full run
- **Compatibility:** Windows 10/11, PowerShell 7+, UTF-8 encoding

---

## REPOSITORY STRUCTURE & PATHS (CORRECTED 2026-01-16)

### Local Development Machine
- **Primary Private Repo:** `D:\Desktop\SecurityNow-Full-Private\` ✅
- **Public Tools Mirror:** `D:\Desktop\SecurityNow-Full\` ✅
- **CRITICAL:** ALL file operations MUST use `$PSScriptRoot` for portability

### Repository Architecture
```
D:\Desktop\SecurityNow-Full-Private/         (Private - LOCAL + GitHub)
├── local/
│   ├── audio/         # MP3 files from TWiT CDN
│   ├── pdf/           # Official GRC PDFs + AI-generated PDFs (by year)
│   └── transcripts/   # Whisper AI transcripts (text files)
├── scripts/
│   ├── sn-full-run.ps1       # v3.1.1 PRODUCTION ENGINE
│   └── Special-Sync.ps1      # Sync script
├── data/
│   ├── SecurityNowNotesIndex.csv  # Episode metadata index
│   └── episode-dates.csv          # Episode → Year mapping
├── docs/                     # Documentation
├── .ai-context.md            # This file
├── COMMON-MISTAKES.md        # Error prevention
└── NEW-THREAD-CHECKLIST.md   # Development workflow

D:\Desktop\SecurityNow-Full/                 (Public Mirror - LOCAL + GitHub)
├── scripts/           # Sanitized scripts ONLY (no credentials)
├── docs/              # README, FAQ, WORKFLOW, TROUBLESHOOTING
├── data/              # Public data files
└── .github/FUNDING.yml
```

### GitHub Repositories
- **Private:** [msrproduct/securitynow-full-archive](https://github.com/msrproduct/securitynow-full-archive)
- **Public:** [msrproduct/securitynow-archive-tools](https://github.com/msrproduct/securitynow-archive-tools)

---

## TOOL INSTALLATION PATHS (VERIFIED 2026-01-16)

### Whisper Speech-to-Text ⚠️ CRITICAL
- **Executable:** `C:\tools\whispercpp\whisper-cli.exe`  
  ❌ **NOT** `C:\whisper-cli\whisper-cli.exe`
  ❌ **NOT** `C:\whispercpp\whisper-cli.exe`
- **Model:** `C:\tools\whispercpp\models\base.en.bin`

### wkhtmltopdf HTML → PDF
- **Executable:** `C:\Program Files\wkhtmltopdf\bin\wkhtmltopdf.exe`
- **Required Flags:**
  ```powershell
  & $wkhtmlPath --enable-local-file-access `
                --no-pdf-header-footer `
                --quiet `
                "$inputHtml" "$outputPdf"
  ```

### PowerShell
- **Version Required:** 7.4+ (NOT Windows PowerShell 5.1)
- **Check:** `$PSVersionTable.PSVersion`

---

## KEY TECHNICAL DECISIONS

| Date | Decision | Rationale | Impact |
|------|----------|-----------|--------|
| 2026-01-11 | Dual public/private repos | Legal: keep copyrighted media off public GitHub | Enables OSS contributions without DMCA risk |
| 2026-01-12 | wkhtmltopdf over browser PDF | Browser adds file paths to footers | Clean AI PDFs with disclaimer |
| 2026-01-13 | `episode-dates.csv` dynamic lookup | Hardcoded year ranges fail for holiday episodes | Correct folder placement |
| 2026-01-13 | `$PSScriptRoot` for all paths | Eliminates hardcoded assumptions | Works across machines |
| 2026-01-15 | `.ai-context.md` system | Prevent 8-hour debugging loops | 21.5 hrs saved (projected) |
| 2026-01-16 | **Complete system cleanup** | 5 orphaned folders causing confusion | Clean development environment |
| 2026-01-16 | **Path corrections v3.3** | Local folder ≠ GitHub repo name | Eliminated remaining confusion |

---

## CRITICAL PATHS & COORDINATES

### GRC Archive URLs
- **Current Year:** `https://www.grc.com/securitynow.htm`
- **Past Years:** `https://www.grc.com/sn/past-{YYYY}.htm` (2005–2025)
- **PDF Pattern:** `https://www.grc.com/sn/sn-{NNNN}-notes.pdf`
- **HTML Fallback:** `https://www.grc.com/sn/sn-{NNNN}.htm`

### TWiT Audio CDN
- **MP3 Pattern:** `https://cdn.twit.tv/audio/sn/sn{NNNN}/sn{NNNN}.mp3`
- **Example:** Episode 7 → `https://cdn.twit.tv/audio/sn/sn0007/sn0007.mp3`

---

## CURRENT DEVELOPMENT FOCUS (2026-01-16 15:30)

### Active Work
1. ✅ **COMPLETE:** System cleanup (5 orphaned folders deleted)
2. ✅ **COMPLETE:** Path corrections in `.ai-context.md` v3.3
3. ✅ **COMPLETE:** Git repos synced and pushed
4. ⏳ **NEXT:** Resume v3.1.2 bugfix work (TEXT WALL PDF, DryRun UX)

### Blockers
- ✅ **RESOLVED:** All path confusion eliminated
- ✅ **RESOLVED:** Orphaned test folders cleaned up
- ✅ **RESOLVED:** Duplicate files removed

### Next Milestone
**v3.1.2 "Production Bugfixes"**
- Fix TEXT WALL PDF rendering issue
- Improve DryRun mode UX (clarify "Failed" status)
- Then proceed to v3.2.0 performance optimizations

---

## FILE SYNC WORKFLOW

### Sync Order (NEVER REVERSE)
1. **Private Repo First:** Commit to `D:\Desktop\SecurityNow-Full-Private\`
2. **Then Public:** Run `Special-Sync.ps1` to copy tools/docs → public repo
3. **Validation:** Confirm NO media files in public repo

### Sync Script
```powershell
# Location: D:\Desktop\SecurityNow-Full-Private\scripts\Special-Sync.ps1
cd "D:\Desktop\SecurityNow-Full-Private"
.\scripts\Special-Sync.ps1
```

---

## COMMON MISTAKES LOG

### ❌ Mistake #0: Wrong Local Repository Path
**Frequency:** Every AI response before v3.3  
**Error:** AI says `D:\Desktop\SecurityNow-Full\` or `D:\Desktop\SecurityNow-Full-Archive\`

**Why It Happens:**
- Local folder name (`SecurityNow-Full-Private`) doesn't match GitHub repo name (`securitynow-full-archive`)
- Previous versions of this file had incorrect path
- AI cached wrong assumptions

**Correct Paths:**
```powershell
# ✅ CORRECT
$privateRepo = "D:\Desktop\SecurityNow-Full-Private\"  # Local private
$publicRepo = "D:\Desktop\SecurityNow-Full\"           # Local public mirror

# ❌ WRONG
$repo = "D:\Desktop\SecurityNow-Full-Archive\"  # Never existed
$repo = "D:\Desktop\SecurityNow-Full\"          # Public mirror, not private
```

**Validation:**
```powershell
Test-Path "D:\Desktop\SecurityNow-Full-Private\scripts\sn-full-run.ps1"  # True
Test-Path "D:\Desktop\SecurityNow-Full\.git"  # True (public mirror)
```

---

### ❌ Mistake #1: Wrong Whisper Path
**Frequency:** Every sn-full-run.ps1 edit since 2026-01-11  
**Error:** AI suggests `C:\whisper-cli\` or `C:\whispercpp\`

**Correct Path:**
```powershell
$whisperExe = "C:\tools\whispercpp\whisper-cli.exe"       # ✅ CORRECT
$whisperModel = "C:\tools\whispercpp\models\base.en.bin" # ✅ CORRECT
```

---

### ❌ Mistake #2: Wrong Sync Script Name
**Frequency:** Every sync workflow reference  
**Error:** AI says `Sync-Repos.ps1`

**Correct:**
```powershell
.\scripts\Special-Sync.ps1  # ✅ CORRECT ONLY
```

---

### ❌ Mistake #3: Hardcoded Paths in Scripts
**Frequency:** ~40% of AI-generated code  

**Correct Pattern:**
```powershell
# ✅ CORRECT - Portable
$repoRoot = Resolve-Path "$PSScriptRoot\.."
$dataFolder = Join-Path $repoRoot "data"

# ❌ WRONG - Hardcoded
$dataFolder = "D:\Desktop\SecurityNow-Full-Private\data"
```

---

## EMERGENCY QUICK-REF (UPDATED 2026-01-16 15:30)

**Correct Paths:**
```powershell
# Local Repos
D:\Desktop\SecurityNow-Full-Private\          # ✅ Primary private repo
D:\Desktop\SecurityNow-Full\                  # ✅ Public mirror

# GitHub Repos  
https://github.com/msrproduct/securitynow-full-archive      # ✅ Private
https://github.com/msrproduct/securitynow-archive-tools     # ✅ Public

# Tools
C:\tools\whispercpp\whisper-cli.exe                         # ✅ Whisper
C:\Program Files\wkhtmltopdf\bin\wkhtmltopdf.exe           # ✅ PDF

# Scripts
.\scripts\Special-Sync.ps1                                  # ✅ Sync
.\scripts\sn-full-run.ps1                                   # ✅ Engine v3.1.1
```

**When path confusion occurs:**
1. ⚠️ **STOP** - Check this file FIRST
2. Verify: `Test-Path "D:\Desktop\SecurityNow-Full-Private\"`
3. Do NOT proceed with wrong paths

---

## VERSION HISTORY

| Version | Date | Changes |
|---------|------|---------|  
| 3.3 | 2026-01-16 15:30 | **CRITICAL:** Fixed local repo path (SecurityNow-Full-Private), added cleanup completion status, verified all paths, eliminated all path confusion |
| 3.2 | 2026-01-16 14:15 | Fixed Whisper path (4th time), moved to top with validation |
| 3.1 | 2026-01-15 22:20 | Fixed sync script name (Special-Sync.ps1), drive audit |
| 3.0 | 2026-01-15 | Complete context system with mistake log |
| 2.0 | 2026-01-13 | Added script versioning, episode-dates.csv |
| 1.0 | 2026-01-11 | Initial draft |

---

**END OF `.ai-context.md` v3.3**  
**✅ CLEANUP COMPLETE - CLEAN DEVELOPMENT ENVIRONMENT ACHIEVED**  
**✅ ALL PATHS CORRECTED - READY FOR v3.1.2 BUGFIX WORK**