# AI Context - Security Now Archive Tools
**Version:** 3.4 üîß AUDIT CORRECTIONS  
**Last Updated:** 2026-01-16 17:08 CST by Perplexity AI  
**Project Phase:** Production - Clean Development Environment Achieved

---

## ‚úÖ SYSTEM CLEANUP COMPLETE (2026-01-16 15:30)

### Cleanup Summary
- ‚úÖ **Orphaned directories deleted:** 5 folders (~750MB reclaimed)
  - `C:\SecurityNow\`
  - `C:\SecurityNowTest\`
  - `D:\Desktop\SecurityNow-Setup\`
  - `D:\Desktop\SecurityNow-Test\`
  - `D:\Desktop\SecurityNow-Test-wkhtmltopdf\`

- ‚úÖ **Local repos cleaned:** 11 duplicate/obsolete files removed
  - Private repo: 5 files deleted (contributing.md, Create-EpisodeDateIndex.ps1, etc.)
  - Public repo: 6 files deleted (.gitignore-private, test folders, etc.)

- ‚úÖ **Git repos synced:** Both repos pushed to GitHub successfully
  - Private: Commit `74f27bc`
  - Public: Commit `3240e6b`

- ‚úÖ **Verification passed:** Clean development environment confirmed
  - C:\ drive: No SecurityNow folders ‚úì
  - D:\Desktop: Only 2 repos remaining ‚úì
  - Git status: Working tree clean ‚úì

### Current Clean State
**C:\ Drive:**
- ‚úÖ `C:\tools\whispercpp\` - Whisper installation only
- ‚úÖ `C:\Program Files\wkhtmltopdf\` - PDF tool only
- ‚úÖ No project files or test folders

**D:\Desktop:**
- ‚úÖ `SecurityNow-Full-Private\` - Primary private development repo
- ‚úÖ `SecurityNow-Full\` - Public tools mirror
- ‚úÖ No orphaned test/setup folders

**Backup Created:**
- `D:\Backup\SecurityNow-Cleanup-20260116-152439\` - Full backup of deleted folders

---

## ‚ö†Ô∏è CRITICAL PATH CORRECTIONS (2026-01-16 15:30)

### PRIMARY REPOSITORY PATHS (CORRECTED - FINAL)
**‚ùå WRONG (All previous versions):**
```
D:\Desktop\SecurityNow-Full-Archive\
D:\Desktop\SecurityNow-Full\
```

**‚úÖ CORRECT (Verified 2026-01-16 15:30):**
```
Local Private Repo:  D:\Desktop\SecurityNow-Full-Private\
GitHub Private Repo: msrproduct/securitynow-full-archive
Local Public Mirror: D:\Desktop\SecurityNow-Full\
GitHub Public Repo:  msrproduct/securitynow-archive-tools
```

**CRITICAL NOTES:**
- Local folder name (`SecurityNow-Full-Private`) ‚â† GitHub repo name (`securitynow-full-archive`)
- This mismatch was causing confusion in all previous context versions
- `.ai-context.md` v3.3+ is FIRST version with correct local path

**Validation:**
```powershell
Test-Path "D:\Desktop\SecurityNow-Full-Private\scripts\sn-full-run.ps1"  # Must return True
Test-Path "D:\Desktop\SecurityNow-Full\.git"  # Public mirror
```

### WHISPER PATH (ISSUE #0 - 4TH CORRECTION)
**‚ùå WRONG (AI keeps suggesting):**
```
C:\whisper-cli\whisper-cli.exe
C:\whispercpp\whisper-cli.exe
```

**‚úÖ CORRECT (Verified multiple times):**
```
C:\tools\whispercpp\whisper-cli.exe
C:\tools\whispercpp\models\base.en.bin
```

### SYNC SCRIPT NAME
**‚ùå WRONG:** `Sync-Repos.ps1`, `Sync-Repo.ps1`  
**‚úÖ CORRECT:** `Special-Sync.ps1`

---

## PROJECT OVERVIEW

### Mission
Archive all Security Now! podcast episodes (2005‚Äì2026+) with official GRC PDFs where available, AI-generated transcripts for missing episodes, and proper copyright separation between public tools and private media.

### Tech Stack
- **Languages:** PowerShell 7.x (required)
- **PDF Generation:** wkhtmltopdf 0.12.6
- **Transcription:** Whisper.cpp (base.en model)
- **Version Control:** Git with dual remotes (public + private)
- **File Storage:** Git LFS for MP3/PDF in private repo

### Critical Constraints
- **Legal:** Never commit copyrighted media (PDFs, MP3s) to public repo
- **Performance:** ~1,000+ episodes √ó 3‚Äì5 min/episode = 50‚Äì85 hours full run
- **Compatibility:** Windows 10/11, PowerShell 7+, UTF-8 encoding

---

## REPOSITORY STRUCTURE & PATHS (CORRECTED 2026-01-16)

### Local Development Machine
- **Primary Private Repo:** `D:\Desktop\SecurityNow-Full-Private\` ‚úÖ
- **Public Tools Mirror:** `D:\Desktop\SecurityNow-Full\` ‚úÖ
- **CRITICAL:** ALL file operations MUST use `$PSScriptRoot` for portability

### Repository Architecture
```
D:\Desktop\SecurityNow-Full-Private/         (Private - LOCAL + GitHub)
‚îú‚îÄ‚îÄ local/
‚îÇ   ‚îú‚îÄ‚îÄ audio/         # MP3 files from TWiT CDN
‚îÇ   ‚îú‚îÄ‚îÄ pdf/           # Official GRC PDFs + AI-generated PDFs (by year)
‚îÇ   ‚îî‚îÄ‚îÄ transcripts/   # Whisper AI transcripts (text files)
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ sn-full-run.ps1       # v3.1.1 PRODUCTION ENGINE
‚îÇ   ‚îî‚îÄ‚îÄ Special-Sync.ps1      # Sync script
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ SecurityNowNotesIndex.csv  # Episode metadata index
‚îÇ   ‚îî‚îÄ‚îÄ episode-dates.csv          # Episode ‚Üí Year mapping
‚îú‚îÄ‚îÄ docs/                     # Documentation
‚îú‚îÄ‚îÄ .ai-context.md            # This file (SOT - synced to public)
‚îú‚îÄ‚îÄ COMMON-MISTAKES.md        # Error prevention
‚îî‚îÄ‚îÄ NEW-THREAD-CHECKLIST.md   # Development workflow

D:\Desktop\SecurityNow-Full/                 (Public Mirror - LOCAL + GitHub)
‚îú‚îÄ‚îÄ scripts/           # Sanitized scripts ONLY (no credentials)
‚îú‚îÄ‚îÄ docs/              # README, FAQ, WORKFLOW, TROUBLESHOOTING
‚îú‚îÄ‚îÄ data/              # Public data files
‚îú‚îÄ‚îÄ .ai-context.md     # Synced FROM private repo
‚îî‚îÄ‚îÄ .github/FUNDING.yml
```

### GitHub Repositories
- **Private:** [msrproduct/securitynow-full-archive](https://github.com/msrproduct/securitynow-full-archive) ‚Üê **SOT for .ai-context.md**
- **Public:** [msrproduct/securitynow-archive-tools](https://github.com/msrproduct/securitynow-archive-tools) ‚Üê Synced copy

---

## TOOL INSTALLATION PATHS (VERIFIED 2026-01-16)

### Whisper Speech-to-Text ‚ö†Ô∏è CRITICAL
- **Executable:** `C:\tools\whispercpp\whisper-cli.exe`  
  ‚ùå **NOT** `C:\whisper-cli\whisper-cli.exe`
  ‚ùå **NOT** `C:\whispercpp\whisper-cli.exe`
- **Model:** `C:\tools\whispercpp\models\base.en.bin`

### wkhtmltopdf HTML ‚Üí PDF
- **Executable:** `C:\Program Files\wkhtmltopdf\bin\wkhtmltopdf.exe`
- **Required Flags:**
  ```powershell
  & $wkhtmlPath --enable-local-file-access `
                --no-pdf-header-footer `
                --quiet `
                "$inputHtml" "$outputPdf"
  ```

### PowerShell
- **Version Required:** 7.4+ (NOT Windows PowerShell 5.1)
- **Check:** `$PSVersionTable.PSVersion`

---

## KEY TECHNICAL DECISIONS

| Date | Decision | Rationale | Impact |
|------|----------|-----------|--------|
| 2026-01-11 | Dual public/private repos | Legal: keep copyrighted media off public GitHub | Enables OSS contributions without DMCA risk |
| 2026-01-12 | wkhtmltopdf over browser PDF | Browser adds file paths to footers | Clean AI PDFs with disclaimer |
| 2026-01-13 | `episode-dates.csv` dynamic lookup | Hardcoded year ranges fail for holiday episodes | Correct folder placement |
| 2026-01-13 | `$PSScriptRoot` for all paths | Eliminates hardcoded assumptions | Works across machines |
| 2026-01-15 | `.ai-context.md` system | Prevent 8-hour debugging loops | 21.5 hrs saved (projected) |
| 2026-01-16 | **Complete system cleanup** | 5 orphaned folders causing confusion | Clean development environment |
| 2026-01-16 | **Path corrections v3.3** | Local folder ‚â† GitHub repo name | Eliminated remaining confusion |
| 2026-01-16 | **Private repo as SOT** | `.ai-context.md` synced private‚Üípublic | Single source of truth established |

---

## CRITICAL PATHS & COORDINATES

### GRC Archive URLs
- **Current Year:** `https://www.grc.com/securitynow.htm`
- **Past Years:** `https://www.grc.com/sn/past-{YYYY}.htm` (2005‚Äì2025)
- **PDF Pattern:** `https://www.grc.com/sn/sn-{NNNN}-notes.pdf`
- **HTML Fallback:** `https://www.grc.com/sn/sn-{NNNN}.htm`

### TWiT Audio CDN
- **MP3 Pattern:** `https://cdn.twit.tv/audio/sn/sn{NNNN}/sn{NNNN}.mp3`
- **Example:** Episode 7 ‚Üí `https://cdn.twit.tv/audio/sn/sn0007/sn0007.mp3`

---

## CURRENT DEVELOPMENT FOCUS (2026-01-16 17:15)

### Active Work
1. ‚úÖ **COMPLETE:** System cleanup (5 orphaned folders deleted)
2. ‚úÖ **COMPLETE:** Path corrections in `.ai-context.md` v3.3 ‚Üí v3.4
3. ‚úÖ **COMPLETE:** Git repos synced and pushed
4. ‚úÖ **COMPLETE:** Space Instructions updated (single SOT)
5. ‚úÖ **COMPLETE:** Private repo established as SOT for `.ai-context.md`
6. ‚è≥ **NEXT:** Resume v3.1.2 bugfix work (TEXT WALL PDF, DryRun UX)

### Blockers
- ‚úÖ **RESOLVED:** All path confusion eliminated
- ‚úÖ **RESOLVED:** Orphaned test folders cleaned up
- ‚úÖ **RESOLVED:** Duplicate files removed
- ‚úÖ **RESOLVED:** Space Instructions simplified
- ‚úÖ **RESOLVED:** `.ai-context.md` SOT established (private repo)

### Development Roadmap
- **v3.1.1 (CURRENT):** ‚úÖ Stable production engine
- **v3.1.2 (NEXT):** üîß Bugfixes (TEXT WALL PDF, DryRun UX)
- **v3.2.0 (PLANNED):** ‚ö° Performance (40-80√ó speedup via Distil-Whisper, parallel processing)
- **v3.3.0 (FUTURE):** ü§ñ Automation (scheduled episode checks, batch missing episodes)

---

## FILE SYNC WORKFLOW

### Sync Order (NEVER REVERSE)
1. **Private Repo First:** Commit to `D:\Desktop\SecurityNow-Full-Private\`
2. **Then Public:** Run `Special-Sync.ps1` to copy tools/docs ‚Üí public repo
3. **Validation:** Confirm NO media files in public repo

### Sync Script
```powershell
# Location: D:\Desktop\SecurityNow-Full-Private\scripts\Special-Sync.ps1
cd "D:\Desktop\SecurityNow-Full-Private"
.\scripts\Special-Sync.ps1
```

**IMPORTANT:** `Special-Sync.ps1` now includes `.ai-context.md` sync from private‚Üípublic

---

## COMMON MISTAKES LOG

### ‚ùå Mistake #0: Wrong Local Repository Path
**Frequency:** Every AI response before v3.3  
**Error:** AI says `D:\Desktop\SecurityNow-Full\` or `D:\Desktop\SecurityNow-Full-Archive\`

**Why It Happens:**
- Local folder name (`SecurityNow-Full-Private`) doesn't match GitHub repo name (`securitynow-full-archive`)
- Previous versions of this file had incorrect path
- AI cached wrong assumptions

**Correct Paths:**
```powershell
# ‚úÖ CORRECT
$privateRepo = "D:\Desktop\SecurityNow-Full-Private\"  # Local private
$publicRepo = "D:\Desktop\SecurityNow-Full\"           # Local public mirror

# ‚ùå WRONG
$repo = "D:\Desktop\SecurityNow-Full-Archive\"  # Never existed
$repo = "D:\Desktop\SecurityNow-Full\"          # Public mirror, not private
```

**Validation:**
```powershell
Test-Path "D:\Desktop\SecurityNow-Full-Private\scripts\sn-full-run.ps1"  # True
Test-Path "D:\Desktop\SecurityNow-Full\.git"  # True (public mirror)
```

---

### ‚ùå Mistake #1: Wrong Whisper Path
**Frequency:** Every sn-full-run.ps1 edit since 2026-01-11  
**Error:** AI suggests `C:\whisper-cli\` or `C:\whispercpp\`

**Correct Path:**
```powershell
$whisperExe = "C:\tools\whispercpp\whisper-cli.exe"       # ‚úÖ CORRECT
$whisperModel = "C:\tools\whispercpp\models\base.en.bin" # ‚úÖ CORRECT
```

---

### ‚ùå Mistake #2: Wrong Sync Script Name
**Frequency:** Every sync workflow reference  
**Error:** AI says `Sync-Repos.ps1` or `Sync-Repo.ps1`

**Correct:**
```powershell
# ‚úÖ CORRECT - Full path
D:\Desktop\SecurityNow-Full-Private\scripts\Special-Sync.ps1

# ‚úÖ CORRECT - From repo root
.\scripts\Special-Sync.ps1
```

---

### ‚ùå Mistake #3: Hardcoded Paths in Scripts
**Frequency:** ~40% of AI-generated code  

**Correct Pattern:**
```powershell
# ‚úÖ CORRECT - Portable
$repoRoot = Resolve-Path "$PSScriptRoot\.."
$dataFolder = Join-Path $repoRoot "data"

# ‚ùå WRONG - Hardcoded
$dataFolder = "D:\Desktop\SecurityNow-Full-Private\data"
```

---

### ‚ùå Mistake #4: GRC HTML Parsing - Wrong Regex
**Frequency:** 4 failures in one day (2026-01-11)  
**Error:** AI suggests `Episode \d+ \|` or `Episode \d+ -` or `Episode \d+ `

**Correct Regex for GRC HTML:**
```powershell
# ‚úÖ CORRECT - Uses HTML entity &#160; (non-breaking space)
$episodePattern = 'Episode&#160;(\d{1,4})&#160;-'

# ‚ùå WRONG - These fail on GRC HTML
$episodePattern = 'Episode \d+ \|'   # Uses pipe, not dash
$episodePattern = 'Episode \d+ -'    # Uses regular space
$episodePattern = 'Episode \d+'      # No separator
```

**Why It Fails:**
- GRC uses `&#160;` (HTML non-breaking space), not regular spaces
- GRC uses `-` dash, not `|` pipe
- Must match EXACT pattern: `Episode&#160;{NUM}&#160;-`

---

### ‚ùå Mistake #5: PowerShell Syntax - goto Labels
**Frequency:** 2 times  
**Error:** AI suggests `goto :Done` or `:Label`

**PowerShell Does NOT Support:**
```powershell
# ‚ùå WRONG - This is batch/cmd syntax
:Done
goto Done
```

**Use Instead:**
```powershell
# ‚úÖ CORRECT - PowerShell alternatives
return              # Exit function early
break              # Exit loop
if/else blocks     # Structured control flow
```

---

## NEW THREAD STARTUP PROTOCOL

**Every new development thread MUST:**
1. Read this file (`.ai-context.md`) from private repo
2. Read `NEW-THREAD-CHECKLIST.md` for session workflow
3. Read `COMMON-MISTAKES.md` for error prevention patterns
4. Verify paths with `Test-Path` before proceeding

**Context Files Location:**
```powershell
D:\Desktop\SecurityNow-Full-Private\.ai-context.md              # This file (SOT)
D:\Desktop\SecurityNow-Full-Private\NEW-THREAD-CHECKLIST.md     # Workflow
D:\Desktop\SecurityNow-Full-Private\COMMON-MISTAKES.md          # Errors
```

**Note:** Space Instructions point to public repo copy, but private repo is the source of truth.

---

## EMERGENCY QUICK-REF (UPDATED 2026-01-16 17:15)

**Correct Paths:**
```powershell
# Local Repos
D:\Desktop\SecurityNow-Full-Private\          # ‚úÖ Primary private repo (SOT)
D:\Desktop\SecurityNow-Full\                  # ‚úÖ Public mirror

# GitHub Repos  
https://github.com/msrproduct/securitynow-full-archive      # ‚úÖ Private (SOT)
https://github.com/msrproduct/securitynow-archive-tools     # ‚úÖ Public

# Tools
C:\tools\whispercpp\whisper-cli.exe                         # ‚úÖ Whisper
C:\Program Files\wkhtmltopdf\bin\wkhtmltopdf.exe           # ‚úÖ PDF

# Scripts
.\scripts\Special-Sync.ps1                                  # ‚úÖ Sync
.\scripts\sn-full-run.ps1                                   # ‚úÖ Engine v3.1.1
```

**Verification Commands:**
```powershell
# Test paths exist
Test-Path "D:\Desktop\SecurityNow-Full-Private\scripts\sn-full-run.ps1"  # Should return True
Test-Path "C:\tools\whispercpp\whisper-cli.exe"                          # Should return True
Test-Path "C:\Program Files\wkhtmltopdf\bin\wkhtmltopdf.exe"            # Should return True

# Verify correct repo
cd "D:\Desktop\SecurityNow-Full-Private"
git remote -v  # Should show msrproduct/securitynow-full-archive

# Check engine version
.\scripts\sn-full-run.ps1 -MaxEpisode 1 -DryRun  # Should show v3.1.1
```

**When path confusion occurs:**
1. ‚ö†Ô∏è **STOP** - Check this file FIRST
2. Verify: `Test-Path "D:\Desktop\SecurityNow-Full-Private\"`
3. Do NOT proceed with wrong paths

---

## VERSION HISTORY

| Version | Date | Changes |
|---------|------|---------|  
| 3.4 | 2026-01-16 17:15 | **SOT ESTABLISHED:** Private repo now source of truth, synced to public. Added GRC regex pattern (Mistake #4), PowerShell goto gotcha (Mistake #5), verification commands, NEW-THREAD-CHECKLIST protocol, development roadmap, clarified Special-Sync.ps1 path |
| 3.3 | 2026-01-16 15:30 | **CRITICAL:** Fixed local repo path (SecurityNow-Full-Private), added cleanup completion status, verified all paths, eliminated all path confusion |
| 3.2 | 2026-01-16 14:15 | Fixed Whisper path (4th time), moved to top with validation |
| 3.1 | 2026-01-15 22:20 | Fixed sync script name (Special-Sync.ps1), drive audit |
| 3.0 | 2026-01-15 | Complete context system with mistake log |
| 2.0 | 2026-01-13 | Added script versioning, episode-dates.csv |
| 1.0 | 2026-01-11 | Initial draft |

---

**END OF `.ai-context.md` v3.4**  
**‚úÖ CLEANUP COMPLETE - CLEAN DEVELOPMENT ENVIRONMENT ACHIEVED**  
**‚úÖ ALL PATHS CORRECTED - READY FOR v3.1.2 BUGFIX WORK**  
**‚úÖ AUDIT CORRECTIONS APPLIED - COMPREHENSIVE ERROR PREVENTION**  
**‚úÖ PRIVATE REPO AS SOT - SYNCED TO PUBLIC FOR SPACE ACCESS**
