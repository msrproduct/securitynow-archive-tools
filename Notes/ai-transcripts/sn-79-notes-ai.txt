 (upbeat music)
 - Netcasts you love.
 - From people you trust.
 - This is Twit.
 - Bandwidth for Security Now is provided by AOL Radio
 at AOL.com/podcasting.
 (upbeat music)
 - This is Security Now with Steve Gibson,
 episode 79 for February 15th, 2007.
 - Spam bots.
 Security Now is brought to you by
 Astaro, makers of the Astaro Security Gateway
 on the web at www.astaros.com.
 It's time to talk about security
 with everybody's favorite security maven.
 I'm gonna call you a maven from now.
 - I'm not sure what I'm mavening is.
 - It's good, I know it's a good thing.
 It's like a, it's like a, hmm,
 I don't know how to describe it.
 - An advocate, maybe?
 - No, not like a big shot.
 - Oh.
 - You're kind of a maven is regarded by cohorts
 as a trusted expert in a particular field
 and who seeks to pass his or her knowledge on to others.
 - Well, you are fast with that dictionary.
 (laughing)
 - That's Wikipedia for you, baby, it's right there.
 So you are, I would say that's pretty much you,
 a trusted expert in security
 and you seek to pass your information to others.
 - I'd go along.
 - You to maven, man.
 And today we're gonna talk about what, Mr. Maven?
 - Well, a couple things, it's funny,
 I was listening to one of your recent TWIT broadcasts.
 I sort of listened to them in the background
 when I'm doing work that I, you know,
 where I can have, you know, one ear on that.
 And you guys were talking about,
 this is in the last couple of weeks,
 the really continuing expansion of zombie botnet
 fleets, do you remember that I was a couple of weeks ago,
 somebody had some stats about the percentage of PCs
 that are now believed to be infected
 with some sort of remote control bot.
 - Yeah, it was a Vint Cerf, the father of the internet
 who said that of the 600 million PCs out there,
 he believed 150 million, one quarter were infected.
 And you know, I've talked to a number of people since then
 who think that number is low.
 - Yeah.
 - It's certainly a very big number.
 - Well, it's phenomenal.
 And of course that corresponds with two things
 'cause these bot fleets are being used
 both for spamming and for attacking
 with denial of service attacks.
 And what I wanted to talk about today
 was the issue of spoofing email.
 It was triggered by, well, in fact,
 before we get into that, we probably ought to talk about a rat
 and then we'll start talking about it.
 - But there's also a news story that we'll talk about
 because botnets were used to try to bring down
 the internet just last week.
 - Right.
 Again, an attack on DNS servers.
 - The root servers, which you have always said
 is the weak link.
 - Yeah, it's a vulnerability for sure.
 - And at some point, maybe this isn't the episode
 but I would love to talk to you.
 We did it on call for help
 and I don't know if we've ever done on security now
 about that vulnerability and they are trying to do things
 to protect people but I would love to talk about that
 at some point on the show.
 - For sure.
 - But meanwhile, let's cover Arata from previous episodes.
 - Well, actually, this is not from previous episodes
 but the big news today and it's actually,
 it's big enough news that it's been picked up
 by a number of different news stories on the net
 is Microsoft released a surprisingly large batch
 of vulnerability fixes on Tuesday.
 - For Vista or XP.
 - Well, for Windows.
 But they included Vista,
 which was one of the things that I picked up on immediately
 'cause and I was looking at it.
 What caught my eye, okay, first of all,
 they Microsoft tied themselves
 for the largest batch of vulnerability updates
 they've ever released.
 They had, there were six critical and six important
 but together those 12 updates fixed about 20 problems
 'cause a couple of the updates fixed multiple problems.
 What caught my eye is I was just sort of scanning it.
 First of all, I looked at the length of the email
 that I received from Microsoft and it's like,
 whoa, this is more than your normal couple one or two.
 - So you get an email that says,
 watch out, here it comes, this is what it's gonna be.
 - Exactly.
 - And so I get that email, that's...
 - If you're able to subscribe to it somewhere
 on Microsoft site and it's just, you know, it's up.
 - It does and it sort of keeps me in the loop.
 Now, the reason that I use that
 is I don't like the idea of this Windows update
 running behind my back and automatically downloading
 and installing things for me.
 I also like--
 - I do, I let it do it.
 I just go ahead and you do anything you want.
 - Well, and I think for most users,
 it's probably the right thing to do,
 at least maybe to download them
 and then advise you when they're ready to install.
 But for example, on my old creaky Windows 2K machine
 that I'm still using, I'm not moving from IE6 to IE7.
 And of course, Microsoft is really pushing IE7 hard.
 So I don't, and then they've got that dot net stuff.
 Now they're a dot net 3.0 and that's 50 megs of blob
 that I just don't want on my machine.
 So, you know, I'm, and I think like many
 of our listeners probably, I'd like to have more control
 over what Microsoft is pushing
 onto my hard drive behind my back.
 So the reason I bring up this security issue is that
 if there are other listeners among our growing base,
 I think you and I were just talking a minute ago,
 the numbers seem to be increasing.
 So, you know, of security now listeners,
 I wanted to make sure that people would do
 an explicit verification, use Windows update
 under your start menu to grab this stuff.
 'Cause there were six zero day vulnerabilities,
 which is to say, as we know from having talked
 about those before, those are exploits
 which appear and surprise everybody.
 Exploits which are active and discovered
 before anyone knows there's even a vulnerability
 let alone a patch for it.
 Now, they were not widespread exploits,
 otherwise our listeners would already have heard
 about them from us.
 They were only being used in more selective targeted attacks,
 but they were discovered on the net being used,
 and then it was from them that these vulnerabilities
 were reverse engineered to find out
 what it was these things were exploiting.
 So, they were among these 20 problems,
 six of them were zero dates.
 Yes, that's unbelievable.
 Well, and, okay, the first in the car,
 my eye as I was saying was when I was scanning
 through this email, I saw vulnerability in HTML
 help active X control could allow remote code execution.
 Well, it's like, whoa, okay, that's a bad one.
 Because once again, that's your typical browser based exploit
 that we've talked about a lot where doing something
 that brings up a page allows a remote site
 to have its way with you and your computer
 behind your back.
 Essentially, you know, the kind of problems
 we're gonna be seeing are mostly this type now,
 because Microsoft has finally got a firewall
 that's running by default.
 So, I don't expect to see wide scale worm problems
 the way we have been before.
 That is, as we said recently, in fact,
 mostly that the problems we're seeing now
 are people visiting unsafe sites with scripting active
 that allows their machine to basically run a script
 that the website provides, which, you know,
 always makes me very nervous
 and they get their machines taken over.
 It's not that the worms aren't out there, they still are,
 but you're protected as long as you're running
 that Windows firewall.
 Correct.
 So other way, I sent them around.
 Well, and any, even if you didn't have the firewall,
 any currently patched system will not fall victim
 to the old code red or, you know, the MS blast worm
 or any of the worms that are still out there poking around
 and will probably never get rid of.
 But on the other hand, it's just,
 it's so fundamentally wrong to have your ports open
 and exposing services that you don't really need
 to have exposed, which are what worms are looking for.
 So you really want the firewall up.
 But then the other vulnerability out of this list of 20
 that caught my eye, yet this was in Microsoft's own
 malware protection engine.
 There was a remote code execution vulnerability there
 in the way it parses PDF files.
 So, and this is Windows Defender for Vista.
 So, Defender has enough, as a bug in it,
 that will allow a bad guy to remotely execute code
 on your system.
 Yes, it says, via a PDF.
 The via a PDF, the, and the problem is,
 Vista's Windows Defender scans incoming stuff
 without user intervention.
 It's trying to protect you.
 In the process, it has, it exposes a buffer overrun
 vulnerability, exactly like we've been talking about a lot
 here recently.
 This was found and reported by the IBM X-Force guys,
 the ISS guys, and they say, by sending a specially crafted
 PDF file, an attacker can trigger a heap overflow
 resulting in remote code execution.
 This file may be sent over common protocols such as SMTP,
 email, HTTP, FTP, et cetera.
 In many cases, this vulnerability may be triggered
 without user interaction.
 The vulnerability exists because an arbitrary integer
 from a PDF file is used in a memory allocation calculation
 without proper bounds checking.
 As a result, an attacker may provide a large integer value
 creating an integer overflow in the calculation.
 This causes a heap overflow with arbitrary file data.
 There are several structures on the heap
 that an attacker may abuse to obtain remote code execution.
 So I mean, here is exactly the kind of stuff
 we've been talking about where a PDF file contains
 a very large integer.
 Some math is done.
 It wraps around to a smaller value, then a small amount
 of memory is allocated when a large amount of data
 is provided, which overflows the buffer that was allocated
 and Wham, you've got a compromised system.
 And I think a couple articles that I've seen have commented
 that, well, the one thing you want to have really be secure
 is the software which is securing you.
 And so here's a vulnerability.
 Yeah, I'm kidding.
 It's Windows Defender, and it affects Vista as well.
 So again, these are really difficult things to fix.
 Now, what I haven't been able to find,
 nor have I been able to test this,
 is whether having hardware depth running
 would protect against this.
 I'm going to keep my eyes out to see
 if I can find any demos for this.
 Oftentimes, exploits will surface a few weeks
 after the patch, just looking for people who haven't made
 their machines current and kept them updated.
 So I may be able to find some sample code to exercise
 this exploit, which would then allow
 me to play with hardware depth under Vista and XP
 and see whether having it enabled
 would have already protected people.
 Because, of course, it would be very cool
 if this was never a problem for people who
 had a hardware depth running.
 We don't know that.
 We don't know one way or another about that yet.
 And anyway, so I absolutely wanted
 to let people know that if they don't have Windows constantly
 checking for updates, go and do one now,
 because there's a big package of goodies
 waiting for you at Microsoft, that you really do
 want to have installed in your machines.
 And this is virtually all versions of Windows.
 I mean, Windows 2K, XP, even Vista,
 all have issues that are being fixed by last Tuesday's,
 the second Tuesday of the month, and it was also
 the 13th of February.
 So that's the right thing.
 It was a little Valentine's Day gift early.
 A little pre-Valentine's day.
 Yeah, exactly.
 You know, I'm looking at my system
 and has yet to tell me I have an update.
 So that's interesting, even in its in and of itself.
 Yeah, it is taking a while for these things
 to get pushed out by Microsoft.
 I noticed that it sometimes is a day or two
 after the second Tuesday that Windows finally
 gets around.
 I think the problem is so many people are using this.
 And of course, Microsoft has all this enabled now.
 And for like for many years in XP and certainly all in Vista,
 that there's got to be a tremendous load
 on Microsoft servers, especially when you get patches
 of this size.
 So they're probably metering out the rate at which they notify
 people of these updates in order to get some control over.
 But with 6-0 day up exploits, it seems a little foolish
 to wait too long.
 And this is why I have turned on the automatic updates
 and just, let's say, go for it.
 Because I don't want to take the chance.
 Is there something people should do before?
 They have started before they receive the downloads.
 If they haven't received them yet, should they stop surfing?
 Well, it's always the case that, as you know,
 my standard advice is be very wary of scripting.
 So many of these are, again, scripting
 based vulnerabilities that are caused by someone browsing
 to somewhere unsafe.
 One of the other ones was really interesting.
 It was a-- it's 016.
 It's technically the 16th one of 2007.
 And that's the cumulative security update for IE,
 both 6 and-- both IE6 and IE7.
 And there were-- that's one of the updates
 that contained multiple vulnerability fixes.
 It turns out that if script tries to instantiate, which
 is the term used in all this ActiveX or COM stuff,
 if a browser script tries to instantiate a COM object, which
 was not intended to be instantiated by IE,
 and there is just a bazillion of those,
 it turns out that a vulnerability was found
 in the way that happens that allows remote code execution.
 So we've got vulnerabilities in ActiveX controls
 that are designed for IE to be able to run them.
 And now we've got even a bigger class of problems,
 because it's been found that it's
 possible to exploit the instantiation process for COM
 objects in the system, which were not intended
 to be instantiated by IE.
 I mean, it's a mess.
 And let me just make this clear.
 Which of these are for Vista, and which of these
 are not for Vista, is--
 I mean, Defender obviously is in Vista, IE7 is in Vista,
 so I presume--
 Yes, but IE7 in Vista is not vulnerable to this particular
 problem.
 And IE7 is also not, because IE7's enhanced security over IE6
 does prevent this-- by default, it prevents
 this particular exploitation.
 The problem is, if IE6 had been configured
 to allow some of these things to run-- because you might have
 some corporate system where you, for some corporate website
 or internal intranet, you were using some COM objects
 in your normal daily business.
 If you then update IE6 to IE7, in order for the update
 process not to break things, it will carry those permissions
 forward, and you'll still be vulnerable.
 So anyway, unfortunately, it's not a simple answer.
 But it is the case that IE7 under Vista is not
 vulnerable to this particular 016 set of problems.
 Although, Vista is vulnerable, as we said, the Windows Defender
 component of Vista is vulnerable.
 And in fact, there's eight different modules
 that Microsoft is now using for its antiviral stuff.
 It's like Windows 1 care.
 That's vulnerable.
 And there are several other places
 where they've got email scanning engines and things that
 are more IT-oriented than end user and consumer.
 All of those, all eight of those things,
 use the common Windows Defender core,
 and they all had this PDF file vulnerability.
 Wow.
 And then some of the other patches, are they XP specific?
 Are there any Vista specific patches, just for Vista?
 No, there was nothing that was only Vista,
 except Windows Defender.
 Of course, you're able to put Defender, I guess, on XP,
 so that sort of falls back there.
 It's both, yeah, yeah.
 Well, that's actually quite interesting.
 In a way, that's encouraging.
 There were no zero-day exploits that were particular to Vista.
 Right, and at the moment, what we're seeing
 is we're seeing the common code that has always
 been in Windows that, unfortunately, Vista
 has carried forward, is still causing a problem.
 It is also troublesome that--
 OK, it's troublesome that Windows Defender has this problem,
 because it was clearly recently written.
 So you can argue that there was lots of legacy code
 in Windows Defender.
 No, because they based it on an anti-spyware program
 from Giant that is fairly old.
 That's a good point.
 They could have inherited bad code.
 Exactly, and probably--
 I'm going to let them off the hook there.
 The PDF file parser, well, actually,
 I was going to let them off the hook by just again saying
 that this kind of stuff is so hard to find.
 I mean, a programmer could stare at that--
 I mean, as a programmer, I have stared at my own code.
 A programmer could stare at that integer math
 and look at it and just not see.
 I mean, just not see how it could be misused.
 It's so difficult to find these things.
 Yeah, but I mean, when you're accepting input from a user,
 those are the places you check.
 Yes, exactly.
 Well, especially, see, as we know, a PDF file
 is basically a form of encapsulated postscript.
 So it's programming.
 It's a scripting language.
 Exactly, so when you open a PDF, you're running a scripting
 code, and that's exactly why a static file, like a PDF,
 would have an integer that something
 would be using to drive an allocation of memory
 that creates this problem.
 Very interesting.
 Yeah, anyway, so the takeaway message
 is make sure, everybody who's listening to this,
 that you know that last Tuesday was a mage patch event,
 the second Tuesday of the month, for Windows,
 and you want to make sure your machines are current,
 because although there's no widespread exploitation
 of these things, they generally do get more popular
 after the news gets out, after a patch occurs.
 We see more exploitation than, in many cases,
 than beforehand, and I wouldn't be at all surprised
 to see that happen here.
 Yeah, yeah.
 Just really, but again, I'm going to look at the brights.
 I'm going to be the optimist here and say the fact
 that Vista now has been out for, what is it, a couple weeks?
 A couple weeks, almost three, well, two weeks,
 and has not had any major exploits that are specific,
 but particularly it is encouraging.
 I mean, that's what we're on this countdown clock, frankly.
 The minute Vista shipped, I'm waiting
 to hear of that first Vista exploit.
 Yeah, they will happen, there's no doubt.
 I'm saying half full, you're saying half empty,
 that's just the way it is.
 Well, I'd for you to be saying half full
 about Windows security legal.
 It's pretty surprising, isn't it?
 That's a real change.
 I think it might just be that I want it to be true.
 I got a really neat note that I just wanted to share
 with our listeners about, this is a different kind,
 sort of about spin right.
 We have an avid security now listener named Russell Gordon,
 who has been listening to the testimonials
 that I've been sharing with our listeners,
 and got to the point where he was looking forward
 to his hard drive crashing.
 He wanted to use spin right.
 He did, I just love this note.
 So he says, he says, "Dear Steve, I'm an avid listener
 "of your Security Now podcast, it's an evil."
 Oh, just listen, it's so great.
 He says, "And I've always heard you in Leo
 "reading the spin right emails that you get.
 "When I would hear those stories,
 "I would think to myself,
 "one day I'll be needing spin right."
 As a matter of fact, after hearing the stories
 and how much success people were having with spin right,
 I was almost eagerly anticipating getting to use it.
 Well, yesterday was my day.
 I'm a controls engineer who programs industrial computers
 called PICS, or PLCs, programmable logic controllers.
 Those are risk-based processors that are extremely reliable
 and harden for the industrial environments they reside in.
 Yesterday, I was at one of my customers' sites,
 which is a brewery in Texas.
 I've been working for several days on upgrading
 one of their programs to change the way
 the beer was being filtered.
 Like, wow, that sounds like a good idea.
 It says, "Yesterday afternoon,
 "I started getting these windows messages
 "about how memory was corrupt.
 "And I noticed that my hard drive light
 "was staying on a lot more than usual.
 "At one point, I had to power the laptop down
 "and turn it back on due to unresponsiveness.
 "When I started to boot up, I got a message saying something
 "to the effect of N-T-O-S-K-R-N-L, the N-T-O-S kernel.
 "X-E is missing or corrupt.
 "I rebooted again, and it never even got far enough
 "to tell me what was wrong.
 "Dead laptop."
 He says, "I knew it was time for me to purchase
 "and download spin right."
 He gets to use spin right now.
 - He said, "What was interesting to me
 "was that after hearing all the stories,
 "I was not even the least bit worried.
 "For some reason, I was in the mindset of,
 "Bring it on, baby."
 (both laughing)
 - We do not recommend this, by the way.
 - Don't go dropping your laptops,
 just so you have a reason to run spin right.
 Anyway, he says, "Because I knew
 "I could probably resolve the problem with my drive.
 "It was being recognized by the BIOS,
 "so I knew that spin right would have a good chance
 "of helping me out.
 "I purchased and downloaded spin right
 "and started it running in level two.
 "It found quite a few problems with my disk,
 "and all but one of them was recoverable.
 "I let it run overnight and came in the next morning
 "and it was complete.
 "I pulled the floppy out of the laptop and rebooted,
 "and there was my windows again running perfectly,
 "just like it should be.
 "Thanks to spin right, Texas,
 "we'll still have a good supply of Shiner beer."
 (both laughing)
 - And filtered, no no less.
 Well filtered Shiner beer.
 Wow, that's really great.
 Another happy story.
 - I just got a kick out at it.
 It's like, "Bring it on, baby."
 - Spin right, of course.
 This is Steve's Disc Recovery and a maintenance program
 and available, excuse me, at grc.com.
 Before we get into the show, are you ready?
 - Yeah.
 - Yeah, 'cause are you ready?
 Are you prepared?
 I would like to mention our sponsor, Staro,
 because version seven of the,
 this is good news of the Staro Security Gateway
 is here now.
 And of course, Staro makes this great security software,
 and they've been a sponsor of the show for some time,
 and we are really happy to have them as a sponsor.
 Let me just talk a little bit about version seven
 because there are a number of new improvements,
 including transparent email encryption and decryption.
 You know, I'm a big proponent of that.
 - Well, and Leo, let me just interrupt you to say,
 I think that is so cool,
 because it means that the machine,
 that your gateway machine does all the encryption and decryption.
 - For you.
 - So inside your network,
 you don't have to have any of that stuff.
 You don't need to see any of that stuff.
 - You don't have to be aware of it.
 I think this is great.
 You can use SMI, more open PGP standards.
 Inbound email is automatically decrypted too,
 so it's just really a great solution, completely automatic.
 They also now have secure remote access on their VPN via SSL,
 which as you know, makes VPN so much easier.
 - Yep.
 - Let's see what else.
 Let's see, in fact, I think it's the only UTM market,
 appliance on the market with VPN solutions
 that are SSL, IPsec, L2TP, and PPTP with SSL VPN.
 I mean, they're really covered the waterfront there.
 Can be clustered for scalability.
 So you know, if it has you grow,
 so will you're a star or gateway?
 In fact, you can even get up to 10,
 clustered together without load balancers
 that does it automatically,
 and they're gonna continue to offer the home use package,
 but the V7 package will now be free of charge.
 Get this and we'll include the base license,
 all subscriptions, and a star up to date,
 but it'll be limited to 10 IP addresses or 10 users
 or 1,000 concurrent connections, plenty for a home user.
 So you don't even have to purchase
 the home user subscription anymore,
 the one that we were talking about for 79 euros.
 You get that for free.
 These guys are the good guys.
 Aren't they great?
 You can download a star of V7 for free on the website
 or call them for a free demo unit.
 A-S-T-A-R-O.com.
 I am just really pleased that they've made that free now,
 including the subscriptions.
 That just makes it so much,
 so much of a great product for everybody out there.
 Now, let's get to our topic of the day,
 and I think it couldn't be more apropos.
 The use of bot networks,
 and you're gonna talk about one particular use of bot networks.
 - Well, yeah, okay, the problem is,
 and we've talked about this before,
 that bot networks are one of the new ways
 of disseminating spam.
 So when these little bots that are running on,
 by some reports, what is it, 150 million machines,
 one quarter of all PC,
 when they're not being used to go blow some website
 off the net through denial of service attack,
 they are being used and it's been confirmed
 for sending spam, they're like sources of spam.
 A couple times, we've received some complaints from people
 saying, "Hey, you, GRC, Steve Gibson sent me this spam,"
 and it's like, "I guarantee you I can send you any spam."
 And I'll scroll down and they'll like have attached the spam,
 and it's some horrible blob of keyword stuff
 meant to get through the spam filters,
 and then typically it'll have some binary attachment,
 which is some evil thing, so it's not only spam,
 it's probably malware that is being sent,
 and something in the headers has led them to believe
 that I sent it.
 - Well, often, it's the from address
 is xyz33@grc.com.
 I'm getting those to twit.tv all the time.
 And I hear from people all the time
 saying, "They're using my address."
 - Exactly, and so what the spam generators have
 is a whole list of reputable websites,
 like mine, like yours, like many others,
 seen at an Amazon, so they have a huge list
 of reputable websites, and they'll randomly pick
 those websites and spoof them as the source
 for the spam they're sending out,
 in order to get through people's filters,
 in order to basically try to steal the credibility
 which is built up by good domains,
 and ride their junk through on that credibility.
 - I wonder if that works though,
 I don't think anti-spam solutions aren't fooled
 by the return address.
 - Well, no, it actually takes more than that,
 but in the samples that I have been sent
 from spam that has been sent in GRC's name,
 the headers do provide some reason to believe
 that it came from us.
 And that's what I wanted to talk about.
 I wanted to talk about how the headers can,
 well, there's one mechanism in email,
 which is it's very cool, and it turns out
 it's very useful for tracking down the true source
 of spam that is received.
 And so this is of interest to listeners
 because if they get some stuff
 and wanna understand a little bit more
 about the path it took from wherever it was originated
 to their machine, that information is in the headers.
 The idea is that email was originally designed
 with what's called a store and forward model
 where you would have so-called post offices
 and those would receive email not only
 for their own recipients, but actually technically
 for anyone, that is, in the old days,
 in the good old days of the original design
 of the internet before it became so subject to abuse,
 you'd have an SMTP server, simple mail transfer protocol,
 SMTP, which would be out on the net listening on port 25
 for anybody who wanted to connect to it.
 And it would accept a connection coming in on port 25
 and say, hi there, identify who it was and accept email.
 Now, if the email was bound for its own domain,
 its users, it would store it locally,
 and then the users would use a different protocol,
 originally something called POP, P-O-P,
 the post office protocol,
 that's what clients use to hook up to their POP server
 and that's in the case of POP, it's on port 110,
 they would hook up to it in order to retrieve their mail.
 IMAP is the other now arguably as popular,
 if not more protocol, that essentially does the same thing,
 but it's more recent and has additional features.
 In the case though, that this SMTP server
 received email not bound for one of its users,
 it would still accept it and say, oh, hmm,
 this isn't for me, but I'll send it on towards direction.
 So it would look up using DNS,
 it would look up the, what's called the MX records in DNS,
 MX stands for mail exchange and find the IP address
 of the SMTP server for that mail's intended recipient,
 and it would connect to that server and forward the mail.
 So it was sort of a go-between.
 Well, this quickly became exploited by spammers,
 and a server operating like this is known now
 as an open relay, because it is a relay point,
 it will accept email intended for people other than
 its own users, that is other than its own domain,
 and happily forwarded on.
 So spammers quickly discovered that they could simply
 dump their spam on other people's SMTP servers
 and get them forwarded on their behalf.
 Well, one of the things, one of the consequences
 of this sort of store and forward model
 was realized by the original designers
 of the email system, and this is, again,
 this is part of the original brilliant conception
 of all of this.
 They realized that it would be possible
 for email routing loops to exist
 in this store and forward model.
 That is, they deliberately designed SMTP servers
 to be friendly back when the internet was all just good guys.
 And so you might not be able, for example,
 to send email directly to its destination.
 You'd have to stick it on an intermediate server,
 and then it would try and try and try for days,
 in some cases, to ultimately move the email
 to its final destination.
 The problem is, if DNS was configured
 in erroneous ways, it might be that an SMTP server
 would send email to a destination
 that would either, that would accept it,
 and then in getting ready to forward it on,
 it might send it back to the server it just got it from,
 or it could send it to a third server,
 that would send it back to the first server,
 or any kind of round robin looping like that was possible,
 because the protocol itself didn't disallow that
 from happening.
 So you could see how you could end up with a piece of email
 just being handed off among servers
 in a particular messed up configuration of DNS.
 So the designers, recognizing this problem,
 said, okay, we need a way of tagging email
 such that if an email comes back to a server,
 that it has previously sent,
 it will know that, wait a minute,
 I've already seen this mail,
 I've already received this mail before,
 we've got a problem here,
 and it will not then continue to send it on,
 instead it'll send an error back to the email's apparent sender
 saying this mail cannot be delivered as addressed.
 - And then to prevent just a loop, right, an endless loop?
 - Exactly, and so the way this works is,
 any incoming email, any email received by an SMTP server
 has a new header appended to the front,
 and this is important for people to visualize,
 that there will be like a bunch of so-called email headers,
 it'll say two colon, from colon, subject colon, date colon,
 those are just lines with a word followed by a colon,
 followed by data, and those are the email headers.
 What the receiving server does is,
 it adds its own header, it appends it,
 or prepends it to the top of the email,
 as the first header now on the email,
 and that starts out saying received by.
 So it says, that received by header
 is a way of establishing that it has received
 this piece of mail, it identifies itself,
 it also identifies, and this is really cool and critical,
 the IP address of the connection which it accepted,
 that is, it accepted a connection coming in,
 as I said before, on its port 25.
 Well that means it has a remote IP,
 which we know cannot be spoofed,
 as we've said early on in security now episodes,
 TCP, because it requires this three way handshake,
 that is in establishing the connection,
 packets have to go back and forth three times,
 that validates the IP of each endpoint
 in the two endpoints of a TCP connection,
 so the IP that it logs in this received by header
 cannot be spoofed, that is the IP of something,
 it doesn't know what necessarily,
 but it's definitely the IP of the sender
 of that piece of email, so this received by header
 gets added to the top of the email,
 well, if the email is bound for its own domain,
 for example of grc.com received this piece of email,
 it would say okay, it would just store it,
 and when one of the GRC people,
 one of the clients connected,
 it would say oh, it got some more mail for you,
 and I would receive it.
 If I look at the headers in my email,
 I will see only one received by line
 at the very top of the list of headers,
 which was prepended there by my server
 that received it at grc.com,
 but say now that in the old happy days
 of open email relays,
 this email was not intended for GRC.
 My server would then, the GRC server
 or the receiving server would then forward it
 to its destination on, at least in that direction,
 towards its intended recipient.
 The server that received it
 would add its own received by header,
 and now that one is on top of,
 or in front of the first one.
 If that server forwarded to a third server,
 that third server would, again,
 add its own received by header.
 So the point is every hop that email makes,
 there is a received by header,
 always added to the front of the email.
 And what that does is it creates basically a trace.
 It allows anyone looking at the headers
 to know what path that email took
 as it got towards them.
 And in fact, even though out on the public internet,
 you no longer have open email,
 you very rarely have open email relays,
 because they're quickly found by spammers,
 the people who are looking at spam,
 quickly identify open email systems,
 and will notify you that you've got that problem.
 So it's generally not the case that public servers
 are open relays.
 However, inside of networks,
 like inside of Yahoo, or inside of Google,
 or inside of Cox, in any large organization,
 you may have multiple email servers,
 and so that it's very often the case
 that email will be forwarded internally
 through multiple hops on SMMTP servers,
 which is why users, oh, and also Hotmail, for example,
 which is why users who look at email headers
 will often see multiple received by header lines.
 You would normally not see that, for example,
 if some remote user had sent email directly to its target server,
 you would normally see typically two received by lines.
 The, for example, a user in the Cox network,
 would, their client would send mail to the Cox SMTP server,
 which would add it's received by header line,
 the Cox server would then send it, for example, to GRC,
 my server adds it's received by header line,
 where the mail then sits until I receive it.
 So I would see in the normal case, two received by headers,
 because that mail was received by two SMTP servers,
 the originators SMTP server and the recipients SMTP server,
 sometimes you'll see many more.
 Okay, so the way spoofing is done is the first time
 you see it is pretty clever.
 Some bot somewhere wants someone to believe
 that GRC has initiated, I mean,
 has act is the actual sender and initiator
 of a piece of spam.
 So the mail they send out has a fake received by header
 stuck on the front of it.
 That is most email that is sent out
 doesn't have a received by header,
 because that's only added to the front of mail
 by receiving SMTP servers.
 But remember that these headers are like,
 they're in reverse order, they're stacked so that the,
 the first one is the most recent recipient,
 and then they go back in time.
 So there's nothing to prevent an email
 from being spoofed and generated
 with a fake received by header at the beginning of the mail
 so that when that bot then sends it to some SMTP server,
 that SMTP server will stamp its received by header in front.
 But that's, but that means now that the,
 for example, the spoofed GRC received by header
 is underneath it and it appears that someone at GRC
 sent the mail to our server, which created that stamp,
 and then our server sent it on.
 So, so basically what that does is it creates
 a spoofed piece of email.
 It at first glance, it hides the fact
 that some end user somewhere sent the mail,
 except it turns out that that really falls down
 under closer scrutiny.
 Remember that I said that the received by header
 contains the IP address that the receiving SMTP server
 connected to to receive the mail.
 Well, GRC's server, SMTP server,
 is at a known IP address in, you know, it's in the grc.com network.
 But since a, since a spam generating zombie
 connected to some other SMTP server
 trying to fake it out, the received by header,
 which was added by that server won't show a connection
 from the grc.com IP.
 It'll show a connection from the IP
 of the infected computer.
 And in fact, when I've responded to these spoofed emails
 that people have occasionally sent,
 saying, hey, grc.com sent me some spam.
 You know, I take a look at the email they sent
 and I write back a response explaining to them
 how yes, it does look like grc originated this
 because we're the lowest down header
 in the received by stack except that if you look
 at the second one up, you will find the IP address
 not of grc because our server would have connected
 to the second SMTP server.
 Instead, you see the IP address of the zombie machine.
 And so, so on.
 - So you can actually tell who these zombie machines are.
 - Yes.
 And in fact, that's the cool thing.
 - That's not spoofed.
 - Exactly.
 And that's, here's the point, Leo.
 It cannot be because the receiving SMTP server
 always adds the IP of the other SMTP server
 that it's accepting the email from.
 - And it's not possible for you to have a rogue SMTP server
 that fakes those originating addresses.
 Remember that it's actually using the TCP connection IP
 and there's no way to spoof that.
 And so it's what's been fun is when I've responded
 to these people and I've shown them how to read the,
 I figure I ought to try to educate them
 since they're sending out erroneous complaints
 of about spam, I've educated them,
 I explain and show them this is the IP
 that actually connected to the second SMTP server,
 not GRC's IP.
 And then I'll use my very favorite site
 that I've shared with you, it's dnsstuff.com.
 It's www.dnsstuff.com.
 If people will go there and scroll down a little bit,
 there's this beautiful array of very easy-to-use tools
 it's web-based that allows you, for example,
 to perform what's called a reverse DNS lookup.
 I'll take the IP address out of the second received by header,
 drop it into the DNS stuff and often get the,
 I know a lot about the infected zombie computer.
 I'll know whose network it's in
 and not only do I have the IP address, of course,
 but I actually get more information
 from the reverse DNS, is it DSL, is it a cable modem,
 is it's probably, it's a semi-static IP.
 And so I'll return that and say to the guy,
 this is the source of this spoofed email,
 not me, but some random zombie in Norway
 or in China or in Russia or wherever.
 One of these 150 million--
 - I just did one of, and it's in Mexico, interesting.
 - Yeah. - Very interesting.
 - Yeah, it's very cool.
 - But it's posing as Twit.tv, but it's really a relay.
 Very often it's in the US, many of these zombies are in the US.
 - Actually 20% of spam is currently originating from the US,
 20% from Russia, no, 17% from Russia,
 and I think 20% from China is the most recent stats.
 It turns out that a 67% of all email is now spam.
 So two thirds of email is now spam.
 - Wow, wow.
 - Man, obviously no end in sight
 because this continues to be a problem.
 But at least if our listeners are interested
 in taking a look at some of their own spam,
 they'll be able to see now by looking at,
 especially if it's spoofed,
 if they see multiple received by lines,
 you can normally, if you take a look at the IPs
 in the received by headers, since they are not spoofable,
 those are the actual IPs that each SMTP
 or server in line received, had a connection to,
 and often you'll find that they are end-user IPs,
 and those are infected machines.
 - They're zombies.
 - Yep, they've been taken over.
 - Yeah, that one I'm looking at looks like it was, in fact,
 an end-user machine, fascinating.
 - Yeah, now I'll close by talking about one last,
 and this is pretty quick.
 One last anti-spam measure, which is very cool,
 and this is what GRC uses, and many others are too,
 and that's the SPF, the sender provider framework,
 or sender policy framework has got multiple names,
 and the name is mutated a few times.
 The idea of that is that SPF is a very cool anti-spam
 measure, which is also very useful for anti-spoofing.
 GRC has added a text record in DNS.
 In DNS, you have different types of record,
 and A record in DNS lists the address of the machine.
 I mentioned MX records earlier,
 which give the IPs of mail exchange servers for that domain,
 and there are many different types of records.
 Well, one type is a text record
 where it's basically free form.
 You can put anything in there that you want,
 and anyone who wants to look it up
 can essentially ask for grc.com's text records.
 Well, if they do, they will find one,
 which is formatted with a protocol of this SPF,
 this sender provider framework.
 What it does is it declares the valid IPs
 of email originators for grc.
 That is, in there I say that any email coming from grc
 that's valid has to be in this range of IPs,
 and it's basically grc's network.
 What that means is since it is not possible
 to spoof a TCP connection,
 if a receiving SMTP server had somebody on the line,
 essentially, that is accepted an SMTP connection,
 they would know the IP of the connection originator,
 that if that person then says hi there,
 I'm grc, I've got some email for you.
 Well, that receiving SMTP server can do a lookup
 in grc's DNS records for this SPF record
 and determine what grc's actual range
 of valid email originating IPs are.
 And if the connection it has from somebody claiming
 to be an authentic grc email sender
 isn't in that range, it absolutely knows,
 it's fraudulent, that it is spoofed
 and can simply drop, I mean, they could drop the connection,
 they could tarp it, they could do whatever they want to,
 certainly just discard the email.
 - And that won't have any false positives?
 - No, and that's the beauty of it,
 it cannot be, it cannot false positive.
 There are some problems with this in relaying
 because if grc were to need to relay email
 to a third party server for some reason.
 - I'll give you an example, I talk to people
 who have businesses, they have home addresses
 that they want their business email forwarded to
 and they want to respond from that home address
 using the business address as the reply to.
 - Exactly, and that would fail.
 - Exactly, and in fact, my tech support guy,
 Greg, who's in Phoenix, he uses Cox
 and has in some cases tried to send grc email
 out through his Cox system and oftentimes
 he'll get a bounce back because this system
 is beginning to come online, this SPF technology,
 of course, it's only as good as it is adopted
 and it's trivial to add these SPF records to DNS,
 it's so simple to do.
 In fact, the site that is promoting this,
 even, it has a little online web form
 where you're able to fill it out
 and it builds for you the exact line of text
 that you need to put into your DNS.
 So as a little field form like that as well.
 - Yeah, that's very cool.
 Anyway, so it does absolutely prevent spoofing
 but it does have the problem exactly as you say, Leo,
 that if you are trying to route email
 through some other server and not going direct,
 then you've got a problem.
 You could add an SPF record if you wanted him to do that.
 - That's exactly right.
 - To say, oh, he's an accepted sender or Comcast,
 an accepted sender. - Yes, yes, and in fact,
 well, I wouldn't, I'd be afraid for example.
 - You wouldn't want to open Comcast, obviously.
 - Yes, I wouldn't want to whitelist all of Comcast network,
 but for example, you know, Greg's got a cable modem,
 he's, of course, he's got a NAT router
 which tends to anchor his IP firmly.
 Also, the SPF format is flexible enough
 that you can use a domain name.
 For example, I also, in general,
 stuff coming from us comes from an IP at client.grc.com.
 In fact, I think in every case it's client.grc.com
 is any outgoing traffic comes from that IP.
 So you are able to use domain names in that record.
 So for example, if we really wanted to do it this way,
 Greg could have his router set up
 using a dynamic DNS service
 which is giving his IP an automatically updating DNS record,
 I could put that in our in GRC's SPF record
 in which case his IP would always be
 a legitimate source for GRC email.
 - So you only have to change it for your,
 for the domain that's the source of the email.
 You don't have to change it for the MX record
 for his sending SMTP server.
 He doesn't have to have Comcast's cooperation in other words.
 - Right, the idea would be that he would put,
 he would send email to Comcast if they were using SPF,
 they would check to see whether he's a valid generator,
 a valid sender of email from GRC.
 So they would check GRC's DNS.
 - They'd go back and ask you.
 - Yeah.
 - Exactly, they'd go back and ask us through our DNS
 and we'd say yes, that IP can is authorized
 to generate GRC email.
 - So if I want to send an email from leoville.com
 via my fast mail account,
 I wouldn't change my fast mail records,
 I would change my leoville.com's records
 to accept anything from that IP address.
 - Right.
 - Yeah, that makes sense.
 - It also raises the issue that frankly,
 another way to kind of prevent these bots,
 now you tell me if I'm wrong,
 would be for internet service providers
 to validate that the return email address
 was in fact in their network.
 - Well, yes, actually there are many things
 that ISPs could do.
 For example, a bot, in order to do this,
 a bot is in a network where it is able
 to connect to an external SMTP server.
 Okay, you could argue that, well, and in fact, ISPs
 are often now blocking port 25.
 - For that reason.
 - Yeah, exactly, for that reason.
 So you are unable to get a port 25 connection outbound.
 The only thing you can do is plant your email
 on your ISP's server
 and that completely shuts down these bot networks,
 although what the bot networks then do
 is they just dump all their spam on their own ISP.
 - And often the ISP forwards it on.
 - So that's why, by the way,
 I think the US is now only 20%.
 I think it was a much larger number for a long time
 because some of the big high speed internet service providers
 refused to block port 25.
 Now they're doing so.
 And so now it's going offshore to Mexico, Romania, Russia,
 and these other countries where ISPs, I guess,
 are not so enlightened.
 - Right, and in fact, there are various sorts of workarounds
 for getting through a course port 25 blocking.
 If you just allowed an SMTP server
 to run on some other port number,
 then you just have to configure your client,
 but that would work.
 - Right, by the way, that's open SPF.org,
 where that wizard lives, if you wanted to do that.
 And Microsoft has one as well,
 although I don't know, they don't use SPF.
 That's part of the reason this has become such a spaghetti
 is that there are competing standards.
 They ask, Microsoft had one that they did not want to leave
 as completely open.
 They wanted to get intellectual property protection on it
 and then say, "Well, but we'll license it for no cost."
 It's like, "Wait a minute.
 "You know, the open source community said, ah, no, no."
 And so Microsoft has substantially muddied the waters
 by sort of trying to do their own.
 The other very popular one is a more sophisticated approach
 known as domain keys.
 And was it Yahoo?
 - I think Yahoo mail was gonna use that, yeah.
 - Yeah.
 - Poppy, I wanted to do SPF and domain keys for, yeah.
 I think so.
 - Right.
 So we're seeing those.
 But anyway, for people who are curious about the spam
 they receive, and certainly for people like you or I
 or anybody else who's, you know, a high profile,
 good reputable source, we end up being the target
 of these sorts of spoofing attacks,
 it turns out the good news is it's very possible
 to demonstrate that we were not the source
 and there is no way if you know how to read those headers
 that you can be fooled.
 - Yeah, would you send me the boilerplate that you use?
 'Cause I would love to use that.
 I get those comments fairly frequently.
 Actually, more commonly I get people asking me,
 you know, I'm a businessman, I have a domain.
 Why am I getting all this bounced back spam?
 Who's using my domain name?
 And I have to explain the same thing.
 - Yep.
 - And apparently there's nothing you can do about it.
 - No.
 - As long as people don't require domain authentication
 it's gonna continue.
 - Right, well, and it is interesting too that I mean,
 we noticed that we are getting the IPs of infected machines.
 On the other hand, there's 150 million of them
 and they're all over the globe, so what are you gonna do?
 - Right, right.
 Well, fascinating subject and just one of the ways
 botnets are used, I do hope we'll at some point
 talk about how botnets are used to attack systems
 like as they were recently used to attack
 the domain root servers.
 But that's a topic for another show.
 - That'll be a good one.
 - I think we're all done here, Steve.
 I will see you next Thursday.
 Have a happy week and a happy weekend.
 - Sure.
 - And thanks to our favorite security, Maven.
 - We will be doing episode number 80,
 which of course is gonna be one of our big Q&A episodes.
 - Oh boy.
 - So we'll have lots of good questions
 and we'll address the answers.
 - Go to grc.com, that's Steve's site
 and you can ask questions, post questions.
 There it's also where you can find show notes
 and 16 kilobit versions for the bandwidth impaired
 and of course transcripts so that you can follow along.
 Read along as Steve speaks, which is often useful frankly.
 - Oh, also I should mention there have been some questions
 people saying, how do they send questions to me
 for security now?
 So I wanna remind people just go to grc.com/securitynow
 go to the very bottom of the page
 and there's a web form where you can provide as little
 or as much information about your identity as you choose.
 I don't really care one way or the other,
 but we do like to know names and locations
 in order to read these things on the air
 'cause it makes more sense to know where people are
 and that's how you could submit questions to me.
 - Yes, Steve doesn't take personal mail.
 That's the right thing to you.
 All right Steve, grc.com is the place
 for spin right also, Steve's a great file recovery
 or disk recovery and the maintenance utility
 and now secureable his new program.
 The tests, how secure your system can be.
 - A lot of interest in that after our last episode
 on Hardware Day.
 Yep, grc.com.
 Hey thanks Steve.
 - Thanks. - We'll see you next Thursday
 on Security Now.
  Security Now 
