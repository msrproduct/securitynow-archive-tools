 This is Security Now with Steve Gibson, episode 23, for January 19th, 2006, GRC's Mouse Trap.
 Steve Gibson is back and we are here finally to put a rest to the whole controversy surrounding
 this WMF exploit, whole intentional back door, depending on your point of view.
 Steve, I think you've been in a firestorm of controversy all week.
 Well you know, yes, certainly that's the case, it's like the world ended when I suggested
 that maybe this was an intentional back door, or I guess the word was deliberate, and you
 know, there are a couple things that are very hot about, well, exactly those two words.
 First of all, back door carries a hugely negative connotation, I mean, the only way
 we're used to using it is it's installed by a malicious hacker to get into your system
 remotely, and in fact, you know, you asked me, did this mean that somebody could connect
 into our computer, when we talked about this for the first time last week, and I explained,
 no, no, no, this would only allow someone going to a website to, or in one way or another,
 getting your system to render a meta file could be by receiving email or something to
 run arbitrary code in your machine. Now, the fact is, and you know, we talked about a
 benign sample or example for how you could use this, but I mean, the idea of thinking
 Microsoft is malicious is nuts. I should have been careful to say that that was not what
 I meant. I mean, I run, we all run gigabytes of Microsoft's object code for which we have
 no source, which we totally trust to varying degrees, what it's going to do. I mean, so
 the idea that Microsoft would have malicious intent is completely ridiculous. It was never
 what I meant to imply when I said back door, back door is just, you know, it's the sort
 of the only term we have to describe this new kind of vulnerability that was discovered,
 you know, very early at the early in 2006 or the end of 2005.
 There's a long standing tradition, though, of back doors and code. In fact, many bioses
 for PCs, for instance, have secret passwords you can use to get in if the administrative
 password has been set. And I mean, this is well known. It's not unprecedented.
 Right. And in fact, many people wrote to me saying, Steve, you know, programmers often
 put in their own private back doors just because, you know, they think the code is theirs or
 they have some own feeling of ownership about the system they're designing, or, you know,
 they want to be able to get back in not recognizing how serious doing something like that can
 really be. Now, the second component was my use of the word deliberate. Now, you'll remember
 that last week, what I was saying was, as I was writing this vulnerability tester to
 for the purpose of understanding what was going on, and to ultimately look at the older
 versions of Windows, which Microsoft said were vulnerable, but they were not going to
 patch because they weren't vulnerable enough. The feeling I had with just the way the code
 worked really led me to believe that this was on purpose. This was not, you know, anything
 like the traditional bug. Now, of course, that we understand that this is sort of somehow
 different. One mistake I made, and that was as a consequence of the fact that my test
 meta file only had a single record was I talked about this key. The fact that the meta file
 record had to apparently, in my case, had to be set to an incorrect length in order to
 make this happen, which further increased my suspicion beyond the fact that the mean
 code was running in the image, which is never supposed to happen anyway. It turns out that
 that was a consequence of my meta file image having only a single record, the other exploit
 images. And I should have realized this at the time, the other exploit images created
 by the metasploit framework have multiple meta file records and can have the correct
 length and even ill facts original meta file tester. It used a non a length that was not
 one. So, you know, that was dumb. I fully recognized that that was a mistake I made.
 Microsoft's blog, which came out from the Microsoft Security Research Center the day
 after, you know, corrected this initially and I before I had a chance even to get back
 in and look at it. But I verified that I was wrong about that.
 Does that destroy your argument or does it impact the argument?
 Well, I don't think it does. I mean, it certainly takes some of the edge off of it. But when
 I did finally look at Windows, I mean, and believe me, Leo, I was holding my breath that,
 you know, as I said, I might end up retracting everything and be completely wrong about this.
 When I looked at Windows, I saw, I mean, as clear an example of intention as I have ever
 seen. I mean, it this was this was just code designed to do this code designed to jump
 into the metafile image and run run the code contained in the image.
 Now, Stephen Toulouse, who blogged about this for Microsoft said, well, sure, it's intentional,
 but it's intentional with a benign point of view. It was it was to allow GDI functionality,
 right? No, no one ever believed. I mean, no documentation, no common practice, no use
 ever had metafile images running code. I mean, nowhere. I've put together and I further
 fleshed out the page that I began last week. It was just sort of a placeholder page. This
 is a GRC dot com slash W M F slash W M F dot H T M W M F, of course, for Windows Metafile.
 I've laid the whole thing out. I've got a screenshot and link to Microsoft's original
 documentation from Windows 3.0 and 3.1 explaining what this whole abort proc thing is and that
 it is it is for executing code in the user's application. I mean, it makes it's crazy to
 think that even Microsoft at any time in the past would have thought that it made sense
 to mix code with drawing commands. So the only reason you'd put this in is why?
 The only reason is to run code in an image, which has never been sanctioned, never documented
 and and it makes no practical sense. There's no other legitimate use of that. It's so that
 you could put code in an image. Well, exactly. And even more so, when when a program runs,
 the Windows loader does all kinds of of fancy things fixing up and filling out that IAT that
 we talked about a long time ago with rootkit revealer, the import address table, which essentially
 connects the application into the Windows API. If your code running in an image, you
 have no advantage of Windows loader, which basically makes it feasible for you to talk
 to the rest of Windows. Ilfak, in his vulnerability tester, because of this, had to go through
 all kinds of very tricky hacker hoops in order to explicitly get access to Windows in order
 to just pop up his little dialogue that said you are or you are not vulnerable. It was
 a lot of work. So I mean, it's it's just it doesn't make sense that that Microsoft could
 have ever published the idea of doing this, yet not only did I look at this at the way
 this is implemented, but Mark, our friend Mark Rousanovich from Siss internals, he looked
 at it and sent me email, which I have a link to at also on our WMF page. He analyzed this
 and concluded the just as I had that this was intentional. He was not comfortable saying
 it was a backdoor and I mean, I respect his opinion, you know, backdoor, as I said, is
 a very loaded word that carries with it all kinds of, you know, implicit malice, which
 I never meant to imply. But but Mark looking at the same code I have and actually several
 other people too, recognized that for whatever reason, this is what the coder intended. Now
 that I want to say that separately from what Microsoft intended because, you know, Microsoft
 isn't one mind. They're not like one person that even thinks coherently. And we see examples
 of that all the time. So I'm not saying I have no way to forensically examine or or
 or to know what the source code ever looked like, whether there was a comment there that
 might have said this code will allow images to contain executable code. I mean, we'll
 just not know. Maybe it was a mistake. I mean, it's anything is possible. But you know, as
 I said last week, when I looked more closely at this, the only reasonable conclusion is
 that for some reason, it's intentional. All right. So just standing by that, and we just
 don't with probably never know why or what it was put in there. And it's clearly a dangerous
 thing. And as we've seen, it ended up making a very big security flaw in windows. And you
 know, we were we were talking about Steve to Lucy's blog posting. I also have a link
 to that that did the complete posting. And also I've I've taken it apart and responded
 in line to some of his points. At one point, he explains that windows nine X is not susceptible
 to this at a critical level, because windows nine X platforms have extra security measures
 to prevent this from happening more than XP in 2000 and NT. Well, yes. Well, come on.
 So you you know, I'm not what he said. That's what Microsoft is saying. Me, meaning that
 these these extra protections were removed removed from the later versions of windows.
 Okay. You know, and even Vista, you know, the beta of Vista that isn't even shipped yet,
 Microsoft issued a patch last week, or I guess earlier this week to fix it because they were
 shipping it with the same vulnerability. Now, I got emails from some security folks who
 said, well, wait a minute, if wine has his vulnerability, the windows emulator under
 Linux, that means the wine guys wrote it in shortly. They didn't perpetuate this back
 door. Doesn't that kind of blow your theory to heck? Well, okay, let's talk about wine.
 First of all, ill facts tester, which he, you know, all fairness to him. He wrote quickly.
 And he talked about how, you know, he was only able to write it for the systems he had.
 It says that wine systems are not vulnerable. It's very important for anyone listening to
 this to get a copy of mousetrap, which is GRC's official Windows Metafile vulnerability tester.
 It shows that wine systems are vulnerable unless they are brought up to current patch
 level. So I want to make sure people know about that. We'll talk a little bit more about
 mousetrap. The reason I've named it mousetrap is that I was looking for something, you know,
 less frightening and loaded with negative connotations than back door. And so I said,
 well, we're talking about Metafile image code execution, M-I-C-E. So that's mice. The question
 is, does windows, does your version of windows have mice? So if wine has mice, why would
 the wine people put an intentional window in? Well, you know, those guys brag. And I mean,
 first of all, I got to say they just do a phenomenal job. It boggles my mind that you
 can run one of my apps that takes advantage of lots of windows characteristics under Linux
 on wine and the darn thing even works. So, you know, the idea of emulating the incredibly
 expansive windows API is shocking and daunting. I wouldn't have believed it possible. But,
 you know, they brag quote, bug for bug compatibility with windows. Well, the way you get bug for
 bug compatibility, that is, you know, even duplicating undocumented features is you don't
 code to the to the specification, because of course windows bugs are not in the windows
 specification, you code to what windows actually does. The way you determine that is through
 reverse engineering. So they're disassembling everything and duplicating the calls. Exactly.
 So I mean, and actually this lens credence to my theory, because if, you know, you might
 expect that a rewritten buffer overflow would not be carried into wine, because doing the
 same sorts of things, you know, you there'd be enough difference in translation that, you
 know, a buffer of overflow that's clearly a bug, you know, like a defect in the programmer's
 thinking, it'd be reasonable to presume it wouldn't get copied across. But something
 intentional in windows where anyone looking at the code says, Oh, this is what I'm supposed
 to do. I mean, this is what Mark or son of it, other coders and myself all saw. Well,
 the wine guys saw it too. So they didn't ask, Hey, this is what Microsoft wanted to put
 in. Well, we're going to put it in. We got to be duplicated. Exactly. They didn't ask
 why. Because their admirable goal is compatibility first, ours not to ask why. In this case, it
 bit them because they copied this intentional behavior that's been in windows since NT4.
 Pretty impressive. They actually duplicated one of the worst exploits on windows of all.
 So that's nice job, guys. I mean, but that's what they're claimed to do bugs at all. Yeah,
 all right. Now, okay, now older versions of windows. Yeah, let's talk about that because
 95, 98 and Emmy, there's been a lot of question. Are they vulnerable? Well, it's not what got
 me into all this was, you know, Microsoft said, you know, initially on their vulnerability
 report, all versions of windows were there, then they moved off the older legacy versions
 that that were no longer under there, you know, we'll fix every bug support level. They
 moved its designation from critical to important. So which essentially had the effect that they
 did not need to patch it. Unfortunately, it also had the effect of frightening millions
 of windows 9x platform users, you know, 95, 98, 98, second edition and millennium, because
 they now had the feeling that they were vulnerable to something that could get them that Microsoft
 had chosen not to fix. So I looked at this. Okay, here's the whole here's the absolute
 truth. None of those early platforms are vulnerable at all. Microsoft says, Oh, they
 had, you know, extra precautions were taken. Okay, mumbo jumbo, I don't know, you know,
 we don't know really what that is. We didn't write it into that for the extra precautions
 we forgot later. I've I've I've used Microsoft tools. Microsoft makes symbols available for
 their kernels that allowed their debuggers to show you as you're stepping around inside
 of windows. This is for programmers to figure out why their code is not working. I've gone
 through there is absolutely no possibility. I mean, none. You have as much possibility
 as jumping from earth to the moon as exploiting this under early versions of windows. So I
 mean, I don't know if Steve, I don't know if I'd ever say never with hackers these days.
 But all right, I'll take your word for it. I just, I mean, I've literally, I mean, I've
 sat there and stepped one instruction at a time trying to find a way because I wanted
 to like, you know, make my vulnerability tester as effective as possible. You know, this raises
 an interesting issue. Isn't this exactly how these kinds of exploits are found? People
 just step one by one through all of the different routines and windows looking for holes. They
 must be basically doing what hackers are doing, trying to reverse engineer the code
 of the first place, combing, exactly, combing through the code, you know, looking for anything
 that they can interpret in a way that's their advantage. So, so, so, I mean, really, none
 of these old versions of windows, no one using them has anything to worry about. Can
 you run your mouse trap on windows to see? Absolutely. All versions of windows, mouse
 trap will detect windows mice in every version of windows, including on wine. I ought to
 mention also that there were some versions of wine we encountered during testing earlier
 this week that did crash when trying to run my app. I mean, again, I'm not surprised.
 For that reason, I created a command line version just called mouse trap CMD, which anyone,
 well, first of all, it runs under windows in general, but specifically for wine guys,
 if they've got a version of wine, which is serving their needs, but for whatever reason,
 they can't run my mouse trap and they want to check the vulnerability of their current
 build of wine, they can use the command line version also available on my site in order
 to in order to do that. And just to underscore this, this isn't testing for all vulnerabilities
 with Windows Metafile. This is testing for the existing one that we know about just to
 see if it exists in the version of windows you're using. Just mice. Just mice, just
 testing twice. Now, now the one version of windows that were left hanging out in the
 breeze is NT four. The earlier this week, my an earlier version of mouse trap detected
 NT four as vulnerable. Microsoft says, no, not a critical vulnerability. Don't worry
 about it. Don't need to patch it. Well, the reason they're getting away with that is that
 and we've talked about this. Many people have talked about this that NT four may not have
 a default viewer, which would cause it to display a Metafile. As we know, that's the
 act of causing windows to display a Metafile or even, for example, Google's desktop search
 indexing the Metafile cause the exploit to occur. So NT four users, I would say, I mean,
 if it's a server that has no user interaction, nothing is likely to cause it to display a
 file. And of course, if it's not poking around on an under strange dark website, you know,
 in the in the in the seamier sides of the internet, it probably has you probably have
 nothing to worry about. I don't want to, again, over hype this and cause people to worry.
 But I absolutely want anyone using NT four to know they are vulnerable to this exploit.
 Microsoft's not going to fix it. Because the machines are so old and there are so many
 versions of these of these files, I'm not going to try to tackle that either, especially
 since the target of opportunity, again, as I've said, is relatively shallow. And we've
 got two workable, useful, although, you know, less than ideal patch solutions, which are
 available ill facts, original windows, Metafile vulnerability, Patrick works great on NT four.
 And the NOD 32 guys, I can't remember his whole name is Paulo something. I'll have a link to
 it on our page. There are so there are two patches, which anyone using NT four can safely
 use to suppress this. And when either of those are running, and you run mouse trap to check,
 my mouse trap utility will say this system has no mice. Before running that, this system
 has mice. Good. So it works. Well, it works great. Great. All right. So to recap for the
 less technically inclined, including myself, because this is a little hard for us to follow,
 because it's it really you have to have some knowledge of how programmers work and so forth.
 To recap, it still looks like whatever was done in Windows Metafiles to make them be able to execute
 code was was done intentionally isn't a bug, but is an intentional feature. Everyone not not just I,
 everyone who has seen this mission, everybody agree that it was intentional. No one knows,
 including you why Microsoft did it. And no one is a vurring that Microsoft in some way was doing
 this maliciously. It's just, it's there. We don't know why no one knows who put it in. I mean,
 it may not be Microsoft was Microsoft, but it may not have been a, you know, could have been a
 renegade employee. Could have not yet exactly might not have been officially sanctioned. And we,
 I mean, we certainly hope it wasn't. Yeah. It is obviously a major security flop. Obviously,
 a data files shouldn't be executing code. We don't like that. And but Microsoft has patched it for
 Windows XP and Windows 2000. And there are two very good patches for it for Windows 95, 98,
 and ME. And there's, although, although, remember that those earlier versions don't need it, you only
 need it for NT four. That's right. So, so would you, would you recommend not patching it for those
 earlier version? Oh, yeah, because these patches are actual programs that run on the fly. What I
 was going to do if I needed to was actually modify the Windows code permanently on disk so that it
 would just no longer do this so that people would have essentially the equivalent of a Microsoft
 patch that actually fixed the problem rather than suppressing it. It's important to recognize that
 both ill facts and follows patches. They are, they're not really patches per say. They are
 programs you run in Windows to suppress the vulnerability to keep it from having a chance to happen.
 They don't remove it. So, yeah, you certainly, I mean, anyone running now currently, either of
 these patch utilities on their earlier versions of Windows under the assumption as Microsoft has
 stated that these systems are vulnerable to this can absolutely safely remove those and stop running
 that code. So, you know, you, it is a program you're running, NT four users will have no choice,
 but to run that for the rest of their lives if they're worried about this biting them. And you
 know, if you have to decide how concerned you are about that. Right. Anything else you want to say
 about this? I think this closes the chapter. And a lousy chapter it's been. I'm glad we're closed.
 First of all, because it was such a nasty bug, I do hope people have patched it and gosh,
 only knows how many people were impacted by it and have infections they don't know about and may
 never know about. Well, and two really good things or three really good things came of it.
 We have GRC's mouse trap, which will now be available on our site forever that will allow
 anyone at any time to check whether their Windows system has mice, Metafile image code execution.
 So, we have a new utility, a security utility. Anyone setting up Windows from the beginning
 will always have mice until they bring themselves to Microsoft's current patch level. That's right.
 Remember, this will always be there. It's in the code from the beginning ever since NT4.
 So, that's the first thing that came from this. The second is we've answered the question
 for all users. I mean, the millions of legacy Windows users, they are despite what Microsoft
 claims. I mean, and I don't know why Microsoft is saying this. I mean, it's been suggested that
 maybe it's they're attempting to scare people into upgrading to versions of Windows that are being
 currently maintained. Obviously, people still running Windows 9x machines have chosen for whatever
 reason not to. So, I want to put put to rest forever the issue and the concern that maybe
 they're vulnerable. They are not vulnerable. And if they're running those dynamic exploit
 suppression code patches from ill fact or Apollo, they can remove them. They don't need it.
 Well, Microsoft said just before you go to the third step, Microsoft did say that they were
 vulnerable or they said they didn't know they were if they were vulnerable. No, Microsoft still,
 even in their in their not only their vulnerability report, but but in Steven Toulouse's blog,
 is claiming these systems are vulnerable. Okay. So, they're just not. Okay. Okay. And the third
 thing is NT4 users need to recognize that they are in fact vulnerable, that NT4 will run code,
 contain in a meta file, if for whatever reason, it ever in the future encounters one. So, NT4
 users should run if if they're concerned, you know, if they're like using NT4 to surf the net,
 as opposed to sitting in the back room being a server, if there's a chance of it encountering
 malicious meta files, you'll want to run one of these dynamic vulnerability suppression utilities.
 Because there's no other patch for it. That's the only way to get rid of it.
 Yep. I'm not going to fix it. Microsoft's not going to fix it.
 And finally, at a higher level, I think we've learned something which is there is always this
 risk in close source code that stuff's going on that you don't know about. To me, it's still a
 good argument for why open source is a good idea. Yeah. I find myself gravitating toward
 those kinds of solutions. I'll mention here as we wrap this up that people have written asking
 about open VPN, because of course, but prior to this, we were doing a series on on VPN solutions.
 I just wanted to mention I am in love with open VPN. I've got it working and dancing and prancing.
 I mean, it does everything I want it to. It's just a it's a beautiful open source solution,
 which will allow people to do the things. I mean, really closely approaching what we were hoping
 is the Holy Grail. And in some ways, I think even surpassing it. So, I asked them to be patient.
 Obviously, I've been a little distracted here. It's like, okay, Steve, where did your first
 for the first three weeks of 2006 go? But I'll be getting within the windows code.
 I'll be getting back to nailing all this down, documenting how open VPN works and producing
 some how tos. And we'll be talking about it in the future. And next week, we're going to go back
 to our originally scheduled programming. Oh, who can predict we've been wrong? We've been wrong the
 last three weeks. Well, it's mod four anyway. So I think normally we would do questions and
 answers next time. We got to do questions and answers. Yeah. And then after that, we are going
 to get to kind of the underlying concepts behind how the internet works, which I've been actually
 very interested in, I think. Well, and many people have written saying that they are, I'm very excited
 that we're going to be able to lay some foundation that will then allow us to build on cool things,
 like how crypto works and how to verify security certificates and all kinds of neat technologies.
 Well, this is turned into a college level course on security, but I'm learning a lot. I hope you
 all are too. And I thank you, Steve Gibson for for doing this for us. Of course, more information
 in the show notes are available at Steve site grc.com/securitynow.html. You'll also find 16 kilobit versions
 of the show for the bandwidth impaired. We do thank our friends at AOL radio for providing us
 the bandwidth and broadcasting the show on their podcast channel at AOL music.com. And Steve and
 I are thinking about making this a stereo podcast so that we can, our voices be slightly separated.
 And if that's the case, we'll continue to offer a mono version, a 16 kilobit version,
 but the stereo version will be on AOL music. That seems to be the trend. People want higher
 quality and not lower quality. Well, I get a lot of requests. In fact, many people are wanting the
 podcasting for the lower bandwidth links, but I agree. I think certainly high quality is the step
 in the future. For those with the broadband, it's easy. We ought to mention also that from my side,
 at least, this podcast is also brought to you by Spinrite, which pays all my bills and is responsible
 for making it possible for me to screw around and poke inside windows and reverse engineer VPN
 systems and all that. So, you know, for 17 years, the Spinrite just keeps on going and helping,
 you know, literally tens of thousands of people whose hard drives are in trouble.
 Rightly so, the absolutely the best hard drive maintenance and recovery utility in the world
 Spinrite from grc.com. Thanks Steve. We'll talk next week. Always an adventure.
 Curating now.
